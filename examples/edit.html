<!DOCTYPE html>
<html>
    <head>
        <title>g2 - edit</title>
        <meta charset="UTF-8" />
    </head>
    <body>
        <input id="edit" type="text" size="3" value="abc" onkeydown="setvalue(this);" style="position:absolute;display:none;">
        <span id="editable" contenteditable="true">hello</span>
        <canvas id="c" width="400" height="300" style="border:1px solid black;"></canvas>
    <script src='../g2.js'></script>
    <script>
      var ctx = document.getElementById("c").getContext("2d"),
          rec = ctx.canvas.getBoundingClientRect(),
          cir = {x:50,y:80,r:10,over:function(p){return Math.hypot(p.x-this.x,p.y-this.y) < this.r;},edtval:function(){return this.r;},edtchg:function(val){this.r=+val;}},
          origin = g2().beg().style({lw:2,fs:"snow"}).p().m(20,0).l(0,0).l(0,20).stroke().cir(0,0,4).end(),
          g = g2({cartesian:true}).clr().grid().use(origin).txt("origin",10,10)
                .cir(cir.x,cir.y,cir.r),
          setvalue = function(e) {
             if (e.keyCode === 13)
               ;
                
          },
          toggleedit = function(g,e) {
             var edit = document.getElementById("edit"),
                 tg = e.target,
                 rec = rec = tg.getBoundingClientRect(),
                 p = g.pntToUsr(e.clientX - Math.floor(rec.left) + tg.scrollLeft,
                                e.clientY - Math.floor(rec.top)  + tg.scrollTop,
                                rec.height),
                 overcir = cir.over(p);
                 
             if (edit.style.display === "none" && ) {
                edit.style.left = e.clientX+"px";
                edit.style.top  = (e.clientY-23)+"px";
                edit.style.display = "block";
                edit.focus();
                console.log("h="+edit.style.height);
             }
             else
                edit.style.display = "none";
             e.preventDefault(); 
             return false; 
          },
          render = function render() { g.exe(ctx); requestAnimationFrame(render); };

      ctx.canvas.addEventListener("mousedown", toggleedit, false);
      document.getElementById("edit").addEventListener("keydown", setvalue, false);
      render();
   </script>
    </body>
</html>
