<!DOCTYPE html>
<html>
    <head>
        <title>Hello g2!</title>
        <meta charset="UTF-8" />
    </head>
    <body>
        <canvas id="canvas" width="201" height="241" style="border:1px solid black;"></canvas>
        <script src='../g2.js'></script>

        <script>
		
var ctx = document.getElementById("canvas").getContext("2d");  // Grab canvas context.

var numberOfRaindrops = 10,
    raindrops = new Array(numberOfRaindrops),
	lastRefresh,
	speed = 100,
	umbrella = g2(),
	g = g2();
	
createRaindrops();
createUmbrella();

g.clr().grid().use(umbrella);
for (var i = 0; i<numberOfRaindrops; i++) {
	g.use(raindrops[i].g);
}

window.requestAnimationFrame(step);

function createRaindrops() {
	for (var i=0; i<numberOfRaindrops; i++) {
		var x = randomX();
		var y = randomY();
		raindrops[i] = { x: x,
						 y: y,
						 g: g2(),
						 update: function() { (this.g).del().style("ls","#0600ff","lw",8,"lc","round").lin(this.x,this.y-5,this.x,this.y) }
						};
	}
}

function randomX() { return Math.random() * (170 - 30) + 30; }
function randomY() { return Math.random() * -120; }
		
function createUmbrella() {
	umbrella.grid().style("lw",8,"ls","#30833a","fs","#73df80","lj","round")
			.p().m(100,70).l(100,210).a(-3.14,130,210).stroke()
			.p().m(10,140).a(1,70,140).a(1,130,140).a(1,190,140).a(-2.3,10,140).z().drw();
}

function step(time) {
	var dy = (time - lastRefresh || 0) * speed / 1000;
	lastRefresh = time;
	for (var i=0; i<numberOfRaindrops; i++){
		raindrops[i].y += dy;
		if (raindrops[i].y > 110) {
			raindrops[i].y = randomY();
			raindrops[i].x = randomX();
		}
		var x = raindrops[i].x, y = raindrops[i].y;
		raindrops[i].update();
	}
	g.exe(ctx);
	window.requestAnimationFrame(step);
}

        </script>
    </body>
</html>