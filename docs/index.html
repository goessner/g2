<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>g2 Tests</title>
    <!-- use bootstrap for styling -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
        canvas,
        img,
        td {
            border-style: solid;
        }

        td,
        th {
            border: 1px solid black;
            white-space: pre;
            font: 11px monospace;
        }
    </style>
</head>
<body>
    <script src="https://gitcdn.xyz/repo/goessner/g2/master/src/g2.js"></script>
    <div class="container-fluid" id="container">
        <h1>g2 Tests</h1>
        <h6>g2.js, g2.ext.js, g2.mec.js are referenced. canvas and image should look alike.</h6>
        <p id="errind">Error found at: </p>
    </div>
    <script>
        const errind = document.getElementById('errind');
        const hrefTemplate = "https://github.com/goessner/g2/blob/master/docs/api/g2.$.md";

        function createList({name, tests}) {
            const container = document.querySelector('#container');

            const heading = document.createElement('h3');
            const a = document.createElement('a');
            a.innerHTML = 'g2.' + name;
            a.href = hrefTemplate.replace('$', name);
            heading.innerHTML = 'Tests for ';
            heading.appendChild(a);

            const table = document.createElement("table");
            table.classList.add("table", "table-hover");

            const thead = document.createElement("thead");
            thead.classList.add("thead-dark");
            const tableRow = document.createElement("tr");

            function addColumn(e) {
                const t = document.createElement("th");
                t.scope = "row";
                t.innerHTML = e;
                return t;
            }
            const th = ["#", "name", "src", "canvas", "image", "error"].map(addColumn);

            const tbody = document.createElement('tbody');

            container.appendChild(heading);
            container.appendChild(table);
            table.appendChild(thead);
            table.appendChild(tbody);
            thead.appendChild(tableRow);
            th.forEach(a => tableRow.appendChild(a));

            let itr = 0;
            function createListEntry(entry) {
                const tr = document.createElement('tr');
                tr.id = name + 'Test' + itr++;

                const number = document.createElement('td');
                number.innerHTML = itr;

                const testName = document.createElement('td');
                const testLink = document.createElement('a');
                testLink.innerHTML = entry.name;

                testLink.href = a.href + '#g2+' + (entry.name.match(/-[1-9]+$/) ?
                    entry.name.slice(0,entry.name.lastIndexOf('-')) : entry.name);
                testName.appendChild(testLink);

                const src = document.createElement('td');
                src.contentEditable = true;
                src.innerHTML = entry.src;
                src.addEventListener('input', () => render(src.innerHTML));

                const canvas = document.createElement('td');
                const canvasArea = document.createElement('canvas');
                canvasArea.classList.add('testCanvas');
                const ctx = canvasArea.getContext('2d');
                canvas.appendChild(canvasArea);

                const image = document.createElement('td');
                const imageArea = document.createElement('img');
                imageArea.src = 'img/' + entry.name + '.png';
                image.appendChild(imageArea);

                const error = document.createElement('td');

                [number, testName, src, canvas, image, error].forEach(e => tr.appendChild(e));
                tbody.appendChild(tr);
                function render(str) {
                    try {
                        g2().del().clr().exe(ctx);
                        eval(str).exe(ctx);
                        tr.classList.remove('table-danger');
                    }
                    catch (e) {
                        error.innerHTML = e;
                        tr.classList.add('table-danger');
                        errind.innerHTML += 'g2.' + name + ': ' + itr;
                    }
                }
                render(entry.src);
            }
            tests.forEach(createListEntry);
        }

    </script>
    <script>
        class TestContainer {
            constructor(name, tests) {
                this.name = name;
                this.tests = tests;
                createList(this);
            }
        }
        class Test {
            constructor(name, src) {
                this.name = name;
                this.src = src;
            }
        }
        const pi = Math.PI;
    </script>
    <script src="./index/index.core.js"></script>
    <script src="./index/index.ext.js"></script>
    <script src="./index/index.mec.js"></script>
    <script src="./index/index.chart.js"></script>
</body>

</html>