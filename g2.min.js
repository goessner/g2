/**
 * g2 (c) 2013-16 Stefan Goessner
 * @license MIT License
 * @link https://github.com/goessner/g2
 * 
 */
function g2(){if(this instanceof g2){if(arguments)Object.assign(this,arguments);this.cmds=[];this.curIdx=false;return this}else return g2.apply(Object.create(g2.prototype),arguments)}g2.prototype.addCmd=function(t){this.cmds.push("proto"in t.c?Object.assign(Object.create(t.c.proto),{g2:this},t):t);return this};Object.defineProperty(g2.prototype,"curCmd",{get:function(){return this.curIdx!==false?this.cmds[this.curIdx]:null}});Object.defineProperty(g2.prototype,"state",{get:function(){return this._state||(this._state=g2.State.create(this))}});g2.prototype.cartesian=function t(e){this.state.cartesian=e!==false;return this};g2.prototype.pan=function e(t,i){this.state.trf0.x+=t;this.state.trf0.y+=i;return this};g2.prototype.zoom=function i(t,e,s){this.state.trf0.x=(1-t)*(e||0)+t*this.state.trf0.x;this.state.trf0.y=(1-t)*(s||0)+t*this.state.trf0.y;this.state.trf0.scl*=t;return this};g2.prototype.view=function s(t,e,i){this.state.trf0.x=t;this.state.trf0.y=e;this.state.trf0.scl=i;return this};g2.prototype.del=function r(){this.cmds.length=0;return this};g2.prototype._curPnt=function(){var t=this.cmds.length&&this.cmds[this.cmds.length-1]||false;return t&&(t.cp||t.a)};g2.prototype.p=function n(){return this.addCmd({c:n})};g2.prototype.m=function o(t,e){return this.addCmd({c:o,a:[t,e]})};g2.prototype.l=function a(t,e){return this.addCmd({c:a,a:[t,e]})};g2.prototype.q=function c(t,e,i,s){return this.addCmd({c:c,a:[t,e,i,s],cp:[i,s]})};g2.prototype.c=function h(t,e,i,s,r,n){return this.addCmd({c:h,a:[t,e,i,s,r,n],cp:[r,n]})};g2.prototype.a=function f(t,e,i){var s=this._curPnt(),r=2*Math.PI;if(s&&(t>Number.EPSILON&&t<r||t<-Number.EPSILON&&t>-r)){var n=e-s[0],o=i-s[1],a=Math.tan(t/2),c=n/2-o/a/2,h=o/2+n/a/2,d=Math.atan2(-h,-c);return this.addCmd({c:f,a:[s[0]+c,s[1]+h,Math.hypot(c,h),d,d+t,t<0],cp:[e,i]})}else return this.addCmd({c:g2.prototype.l,a:[e,i]})};g2.prototype.z=function d(){return this.addCmd({c:d})};g2.prototype.stroke=function p(t,e){var i=t===undefined&&e===undefined?[]:typeof t==="string"?[null,t]:typeof t==="object"&&!e?[t]:[t,e];return this.addCmd({c:p,a:i})};g2.prototype.fill=function l(t,e){var i=t===undefined&&e===undefined?[]:typeof t==="string"?[null,t]:typeof t==="object"&&!e?[t]:[t,e];return this.addCmd({c:l,a:i})};g2.prototype.drw=function u(t,e){var i=t===undefined&&e===undefined?[]:typeof t==="string"?[null,t]:typeof t==="object"&&!e?[t]:[t,e];return this.addCmd({c:u,a:i})};g2.prototype.txt=function g(t,e,i,s,r){return this.addCmd({c:g,a:[t,e||0,i||0,s||0,r]})};g2.prototype.img=function y(t,e,i,s,r,n,o,a,c){var h=new Image,f=this.state;f.loading++;h.onload=function d(){f.loaded()};h.onerror=function(){h.src=g2.prototype.img.broken};h.src=t;return this.addCmd({c:y,a:[h,e+.5||0,i+.5||0,s,r,n,o,a,c]})};g2.prototype.img.broken="data:image/gif;base64,R0lGODlhHgAeAKIAAAAAmWZmmZnM/////8zMzGZmZgAAAAAAACwAAAAAHgAeAEADimi63P5ryAmEqHfqPRWfRQF+nEeeqImum0oJQxUThGaQ7hSs95ezvB4Q+BvihBSAclk6fgKiAkE0kE6RNqwkUBtMa1OpVlI0lsbmFjrdWbMH5Tdcu6wbf7J8YM9H4y0YAE0+dHVKIV0Efm5VGiEpY1A0UVMSBYtPGl1eNZhnEBGEck6jZ6WfoKmgCQA7";g2.prototype.lin=function m(t,e,i,s,r){return this.addCmd({c:m,a:[t,e,i,s,r]})};g2.prototype.rec=function v(t,e,i,s,r){return this.addCmd({c:v,a:[t,e,i,s,r]})};g2.prototype.cir=function x(t,e,i,s){return this.addCmd({c:x,a:[t,e,i,s]})};g2.prototype.arc=function b(t,e,i,s,r,n){return this.addCmd({c:b,a:[t,e,i,s||0,r||2*Math.PI,n]})};g2.prototype.ply=function C(t,e,i){var s=C.itrOf(t,i);if(s)this.addCmd({c:C,a:[t,e,s,i]});return this};g2.prototype.ply.iterators={"x,y":function(t,e){return e<t.length/2?{x:t[2*e],y:t[2*e+1]}:{done:true,count:t.length/2}},"[x,y]":function(t,e){return e<t.length?{x:t[e][0],y:t[e][1]}:{done:true,count:t.length}},"{x,y}":function(t,e){return e<t.length?t[e]:{done:true,count:t.length}}};g2.prototype.ply.itrOf=function w(t,e){return!(t&&t.length)?undefined:e&&typeof e.itr==="function"?e.itr:typeof t[0]==="number"?g2.prototype.ply.iterators["x,y"]:Array.isArray(t[0])&&t[0].length>=2?g2.prototype.ply.iterators["[x,y]"]:typeof t[0]==="object"&&"x"in t[0]&&"y"in t[0]?g2.prototype.ply.iterators["{x,y}"]:undefined};g2.prototype.beg=function j(t){return this.addCmd(t?{c:j,a:[t],open:true}:{c:j,open:true})};g2.prototype.end=function S(){return this.addCmd({c:S})};g2.prototype.end.myBeg=function(t){if(t.c===g2.prototype.beg.cmd&&t.open===true){delete t.open;return true}return false};g2.prototype.clr=function k(){return this.addCmd({c:k})};g2.prototype.grid=function A(t,e){this.state.gridBase=2;this.state.gridExp=1;return this.addCmd({c:A,a:[t,e]})};g2.prototype.grid.getSize=function(t,e){var i=t.gridBase||2,s=t.gridExp||1,r;while((r=e*i*Math.pow(10,s))<14||r>35){if(r<14){if(i==1)i=2;else if(i==2)i=5;else if(i==5){i=1;s++}}else{if(i==1){i=5;s--}else if(i==2)i=1;else if(i==5)i=2}}t.gridBase=i;t.gridExp=s;return r};g2.prototype.use=function O(t,e){if(typeof t==="string")t=g2.symbol[t];if(t&&t!==this){var i=this.state;if(t.state&&t.state.loading){i.loading++;t.state.onload(g2.State.prototype.loaded.bind(i))}this.addCmd({c:O,a:[t,e]})}return this};g2.prototype.style=function P(t){return this.addCmd({c:P,a:[t]})};g2.prototype.exe=function T(t,e){var i=g2.ifcof(t);if(i){var s=(e||this).cmds;if(this.state&&this.state.loading){requestAnimationFrame(T.bind(this,t,e))}else if(t&&s){var r=g2.context[i](t),n=e&&e.state;T.pre[i].call(r,this);if(e)e.state=this.state;for(var o=0,a=s.length,c;o<a;o++)if((c=s[this.curIdx=o]).c[i])c.c[i].apply(r,c.a);if(e)e.state=n;T.post[i].call(r,this)}}return this};g2.prototype.exe.pre={};g2.prototype.exe.post={};g2.prototype.cpy=function D(t){if(t&&t!==this)t.cmds.forEach(function(t){this.cmds.push(t)},this);return this};g2.prototype.proxy=function M(t,e){if(typeof t==="string")t=g2.prototype[t];if(t&&t.proto){var i=function(){};i.proto=t.proto;this.addCmd({a:e,c:i})}return this};g2.prototype.findCmdIdx=function(t){for(var e=this.cmds.length-1;e>=0;e--)if(t(this.cmds[e],e,this.cmds))return e;return false};g2.prototype.pntToUsr=function _(t,e,i){var s=this.state&&this.state.trf0||false;return!s?{x:t,y:e}:this.state.cartesian?{x:(t-s.x)/s.scl,y:-(e-(i-s.y))/s.scl}:{x:(t-s.x)/s.scl,y:(e-s.y)/s.scl}};g2.prototype.vecToUsr=function E(t,e){var i=this.state&&this.state.trf0||false;return!i?{x:t,y:e}:this.state.cartesian?{x:t/i.scl,y:-e/i.scl}:{x:t/i.scl,y:e/i.scl}};g2.prototype.dump=function(t){function e(t){var i=[],s,r,n,o,a;for(var c=0,h=t.cmds.length;c<h;c++){a=[];r=t.cmds[c];n=r.a;for(var f=0,d=n&&n.length||0;f<d;f++){if(typeof n[f]==="object"&&n[f]instanceof g2){if(n[f]!==t)a.push(e(n[f]))}else if(n[f]!==undefined)a.push(n[f])}o=/\W*function\s+([\w\$]+)\(/.exec(r.c.toString())[1];if(a.length){s={};s[o]=a}else s=o;i.push(s)}return i}return JSON.stringify(e(this),undefined,t)};g2.transparent="rgba(0, 0, 0, 0)";g2.exeStack=0;g2.context=Object.create(null);g2.ifc=Object.create(null);g2.ifcof=function(t){for(var e in g2.ifc){if(g2.ifc[e](t))return e}return false};g2.State={create:function(){var t=Object.create(this.prototype);t.constructor.apply(t,arguments);return t},prototype:{constructor:function(){this.stack=[{}];this._current={};this.trf0={x:0,y:0,w:0,scl:1};this.loading=0;this.loadHdl=[]},pre:function(t){this.ifc=g2.ifcof(t);this.ctx=g2.context[this.ifc](t);this.stack=[{}];this._current={}},post:function(){delete this.ctx;delete this.ifc},get:function(t){return t in this?this[t]:this._current[t]||g2.State[t]},set:function(t,e){this._current[t]=e},add:function(t){var e=g2.State[this.ifc],i,s,r={};for(var n in t){s=t[n];if(typeof s==="string"&&s[0]==="@")s=this.get(s.substr(1));if(n==="x"||n==="y"||n==="scl"||n==="w")r[n]=s;else if(!(n in this._current)||s!==this._current[n]){this._current[n]=s;if(e[n])e[n].call(this.ctx,s,this)}}if(Object.keys(r).length){this.trf=r;if(e["trf"])e["trf"].call(this.ctx,r,this)}return this},save:function(){this.stack.push(Object.assign({},this._current));return this},restore:function(){this._current=Object.assign({},this.stack.pop());return this},get current(){return this._current},set current(t){this._current=t},get trf(){return this._current.trf||this.trf0},set trf(t){var e=t.w||0,i=t.scl||1,s=i*(e?Math.sin(e):0),r=i*(e?Math.cos(e):1),n=this._current.trf||this.trf0;this._current.trf={x:r*n.x-s*n.y+(t.x||0),y:s*n.x+r*n.y+(t.y||0),w:n.w+e,scl:n.scl*i}},get cssFont(){var t=this.get("fos"),e=this.get("fow");return(t==="normal"?"":t+" ")+(e==="normal"?"":e+" ")+(this.get("foz")+"px "+this.get("fof"))},onload:function I(t){this.loadHdl.push(t)},loaded:function R(){if(--this.loading===0){while(this.loadHdl.length)this.loadHdl.pop()()}}},fs:g2.transparent,ls:"#000",lw:1,lc:"butt",lj:"miter",lwnosc:false,ml:10,sh:[0,0,0,g2.transparent],foc:"#000",fos:"normal",fow:"normal",foz:12,fof:"serif",foznosc:false,trf:{x:0,y:0,w:0,scl:1}};g2.symbol=Object.create(null);g2.symbolNameOf=function(t){for(var e in g2.symbol)if(g2.symbol[e]===t)return e;return false};if(typeof CanvasRenderingContext2D!=="undefined"){g2.ifc.c2d=function(t){return t instanceof CanvasRenderingContext2D};g2.context.c2d=function(t){return t};g2.prototype.exe.pre.c2d=function(t){if(g2.exeStack++===0){var e=t.state,i=e.trf;this.g2=t;this.fillStyle=g2.transparent;this.lineWidth=1;this.strokeStyle="#000";this.setLineDash([]);this.font=e.cssFont;this.setTransform(i.scl,0,0,e.cartesian?-i.scl:i.scl,i.x+.5,(e.cartesian?this.canvas.height-i.y:i.y)+.5);e.pre(this)}};g2.prototype.exe.post.c2d=function(){if(--g2.exeStack===0){this.g2.state.post();this.fillStyle="#000000";delete this.g2}};g2.prototype.p.c2d=CanvasRenderingContext2D.prototype.beginPath;g2.prototype.m.c2d=CanvasRenderingContext2D.prototype.moveTo;g2.prototype.l.c2d=CanvasRenderingContext2D.prototype.lineTo;g2.prototype.q.c2d=CanvasRenderingContext2D.prototype.quadraticCurveTo;g2.prototype.c.c2d=CanvasRenderingContext2D.prototype.bezierCurveTo;g2.prototype.a.c2d=CanvasRenderingContext2D.prototype.arc;g2.prototype.z.c2d=CanvasRenderingContext2D.prototype.closePath;g2.prototype.stroke.c2d=function z(t,e){if(t){this.save();this.g2.state.save().add(t)}if(e&&typeof Path2D!=="undefined")this.stroke(new Path2D(e));else this.stroke();if(t){this.g2.state.restore();this.restore()}};g2.prototype.fill.c2d=function B(t,e){if(t){this.save();this.g2.state.save().add(t)}if(e&&typeof Path2D!=="undefined")this.fill(new Path2D(e));else this.fill();if(t){this.g2.state.restore();this.restore()}};g2.prototype.drw.c2d=function H(t,e){var i=e&&typeof Path2D!=="undefined"?new Path2D(e):false;if(t){this.save();this.g2.state.save().add(t)}i?this.fill(i):this.fill();if(this.fillStyle!==g2.transparent&&this.shadowColor!==g2.transparent){var s=this.shadowColor;this.shadowColor="transparent";i?this.stroke(i):this.stroke();this.shadowColor=s}else i?this.stroke(i):this.stroke();if(t){this.g2.state.restore();this.restore()}};g2.prototype.txt.c2d=function W(t,e,i,s,r){var n=this.g2.state;this.save();if(r)n.save().add(r);if(s){var o=Math.sin(s),a=Math.cos(s);this.transform(a,o,-o,a,(1-a)*e+o*i,-o*e+(1-a)*i)}if(n.cartesian){this.scale(1,-1);i=-i}if(n.get("foc")!==g2.transparent){this.fillStyle=n.get("foc");this.fillText(t,e,i)}else{this.fillText(t,e,i);this.strokeText(t,e,i)}if(r)n.restore();this.restore()};g2.prototype.img.c2d=function q(t,e,i,s,r,n,o,a,c){var h=this.g2.state.cartesian;s=s||t&&t.width;r=r||t&&t.height;if(h){this.scale(1,-1);i=-i-r}if(n||o||a||c)this.drawImage(t,n,o,a,c,e,i,s,r);else this.drawImage(t,e,i,s,r);if(h){this.scale(1,-1)}};g2.prototype.lin.c2d=function F(t,e,i,s,r){if(r){this.save();this.g2.state.save().add(r)}this.beginPath();this.moveTo(t,e);this.lineTo(i,s);this.stroke();if(r){this.g2.state.restore();this.restore()}};g2.prototype.rec.c2d=function L(t,e,i,s,r){if(r){this.save();this.g2.state.save().add(r)}this.beginPath();this.rect(t,e,i,s);g2.prototype.drw.c2d.call(this);if(r){this.g2.state.restore();this.restore()}};g2.prototype.cir.c2d=function N(t,e,i,s){if(s){this.save();this.g2.state.save().add(s)}this.beginPath();this.arc(t,e,i,0,Math.PI*2,true);g2.prototype.drw.c2d.call(this);if(s){this.g2.state.restore();this.restore()}};g2.prototype.arc.c2d=function G(t,e,i,s,r,n){if(n){this.save();this.g2.state.save().add(n)}this.beginPath();this.arc(t,e,i,s,s+r,r<0);g2.prototype.drw.c2d.call(this);if(n){this.g2.state.restore();this.restore()}};g2.prototype.ply.c2d=function Z(t,e,i,s){var r,n=0,o=e==="split";r=i(t,n++);if(!r.done){this.beginPath();this.moveTo(r.x,r.y);while(!(r=i(t,n++)).done){if(o&&n%2)this.moveTo(r.x,r.y);else this.lineTo(r.x,r.y)}if(e&&!o)this.closePath()}g2.prototype.drw.c2d.call(this,s);return n-1};g2.prototype.beg.c2d=function Q(t){this.save();this.g2.state.save().add(t)};g2.prototype.end.c2d=function U(){this.g2.state.restore();this.restore()};g2.prototype.clr.c2d=function V(){this.save();this.setTransform(1,0,0,1,0,0);this.clearRect(0,0,this.canvas.width,this.canvas.height);this.restore()};g2.prototype.grid.c2d=function Y(t,e){var i=this.g2.state,s=i.trf0,r=this.canvas.width,n=this.canvas.height,o=e||g2.prototype.grid.getSize(i,s.scl),a=s.x?s.x%o-o:0,c=s.y?s.y%o-o:0;this.save();if(i.cartesian)this.setTransform(1,0,0,-1,.5,n-.5);else this.setTransform(1,0,0,1,.5,.5);this.strokeStyle=t||"#ccc";this.lineWidth=1;this.beginPath();for(var h=a,f=r+1;h<f;h+=o){this.moveTo(h,0);this.lineTo(h,n)}for(var d=c,p=n+1;d<p;d+=o){this.moveTo(0,d);this.lineTo(r,d)}this.stroke();this.restore()};g2.prototype.use.c2d=function J(t,e){var i=this.g2;this.save();i.state.save().add(e);i.exe(this,t);i.state.restore();this.restore()};g2.prototype.style.c2d=function K(t){this.g2.state.add(t)};g2.State.c2d={fs:function(t){this.fillStyle=g2.State.c2d.texture.call(this,t)},ls:function(t){this.strokeStyle=g2.State.c2d.texture.call(this,t)},lw:function(t,e){this.lineWidth=t/(e.get("lwnosc")?e.trf.scl:1)},lc:function(t){this.lineCap=t},lj:function(t){this.lineJoin=t},lo:function(t){this.lineDashOffset=t},ld:function(t,e){var i=e.get("lwnosc")?e.trf.scl:1;if(i!==1){var s=[];for(var r=0,n=t.length;r<n;r++)s.push(t[r]/i);this.setLineDash(s)}else this.setLineDash(t)},ml:function(t){this.miterLimit=t},sh:function(t){if(t&&t.length>1){this.shadowOffsetX=t[0];this.shadowOffsetY=t[1];this.shadowBlur=t[2]||0;this.shadowColor=t[3]||"rgba(0,0,0,0.5)"}},thal:function(t){this.textAlign=t},tval:function(t){this.textBaseline=t},fos:function(t,e){this.font=e.cssFont},fow:function(t,e){this.font=e.cssFont},foz:function(t,e){this.font=e.cssFont},fof:function(t,e){this.font=e.cssFont},trf:function(t,e){var i=t.scl||1,s=i*(t.w?Math.sin(t.w):0),r=i*(t.w?Math.cos(t.w):1);this.transform(r,s,-s,r,t.x||0,t.y||0);if(e.get("lwnosc")&&i!==1)g2.State.c2d.lwscale.call(this,1/i)},matrix:function(t){this.transform.apply(this,t)},lwnosc:function(t,e){var i=e.trf.scl;if(i!==1)g2.State.c2d.lwscale.call(this,t?1/i:i)},texture:function X(t){return t.indexof&&(t.indexOf("hatch(")===0?g2.State.c2d.hatch.call(this,t.substring(6,t.indexOf(")",7)).split(",")):t==="transparent"?g2.transparent:t)||t},lwscale:function(t){var e=this.getLineDash();this.lineWidth*=t;if(e.length){for(var i=0,s=e.length;i<s;i++)e[i]*=t;this.lineDashOffset*=t;this.setLineDash(e)}},hatch:function $(t){var e=document.createElement("canvas").getContext("2d"),i=+t[3]||10,s=(i+1)*.5;e.canvas.width=e.canvas.height=i;e.fillStyle=t[1]||"white";e.fillRect(0,0,i,i);e.strokeStyle=t[0]||"black";e.lineWidth=+t[2]||1;e.lineCap="square";e.beginPath();e.moveTo(s,.5);e.lineTo(i+.5,s);e.moveTo(.5,s);e.lineTo(s,i+.5);e.stroke();return e.createPattern(e.canvas,"repeat")}}}if(typeof module==="object"&&module.exports)module.exports=g2;