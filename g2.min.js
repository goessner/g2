/**
 * g2 (c) 2013-16 Stefan Goessner
 * @license MIT License
 * @link https://github.com/goessner/g2
 * 
 */
function g2(){if(this instanceof g2){if(arguments)Object.assign(this,arguments);this.cmds=[];this.curIdx=false;return this}else return g2.apply(Object.create(g2.prototype),arguments)}g2.prototype.addCmd=function(t){this.cmds.push("proto"in t.c?Object.assign(Object.create(t.c.proto),{g2:this},t):t);return this};Object.defineProperty(g2.prototype,"curCmd",{get:function(){return this.curIdx!==false?this.cmds[this.curIdx]:null}});Object.defineProperty(g2.prototype,"state",{get:function(){return this._state||(this._state=g2.State.create(this))}});g2.prototype.cartesian=function t(e){this.state.cartesian=e!==false;return this};g2.prototype.pan=function e(t,s){this.state.trf0.x+=t;this.state.trf0.y+=s;return this};g2.prototype.zoom=function s(t,e,i){this.state.trf0.x=(1-t)*(e||0)+t*this.state.trf0.x;this.state.trf0.y=(1-t)*(i||0)+t*this.state.trf0.y;this.state.trf0.scl*=t;return this};g2.prototype.view=function i(t,e,s){this.state.trf0.x=t;this.state.trf0.y=e;this.state.trf0.scl=s;return this};g2.prototype.del=function r(){this.cmds.length=0;return this};g2.prototype._curPnt=function(){var t=this.cmds.length&&this.cmds[this.cmds.length-1]||false;return t&&(t.cp||t.a)};g2.prototype.p=function o(){return this.addCmd({c:o})};g2.prototype.m=function n(t,e){return this.addCmd({c:n,a:[t,e]})};g2.prototype.l=function a(t,e){return this.addCmd({c:a,a:[t,e]})};g2.prototype.q=function h(t,e,s,i){return this.addCmd({c:h,a:[t,e,s,i],cp:[s,i]})};g2.prototype.c=function c(t,e,s,i,r,o){return this.addCmd({c:c,a:[t,e,s,i,r,o],cp:[r,o]})};g2.prototype.a=function f(t,e,s){var i=this._curPnt(),r=2*Math.PI;if(i&&(t>Number.EPSILON&&t<r||t<-Number.EPSILON&&t>-r)){var o=e-i[0],n=s-i[1],a=Math.tan(t/2),h=o/2-n/a/2,c=n/2+o/a/2,p=Math.atan2(-c,-h);return this.addCmd({c:f,a:[i[0]+h,i[1]+c,Math.hypot(h,c),p,p+t,t<0],cp:[e,s]})}else return this.addCmd({c:g2.prototype.l,a:[e,s]})};g2.prototype.z=function p(){return this.addCmd({c:p})};g2.prototype.stroke=function d(t,e){var s=t===undefined&&e===undefined?false:typeof t==="string"?[null,t]:typeof t==="object"&&!e?[t]:[t,e];return this.addCmd(s?{c:d,a:s}:{c:d})};g2.prototype.fill=function l(t,e){var s=t===undefined&&e===undefined?false:typeof t==="string"?[null,t]:typeof t==="object"&&!e?[t]:[t,e];return this.addCmd(s?{c:l,a:s}:{c:l})};g2.prototype.drw=function u(t,e){var s=t===undefined&&e===undefined?[]:typeof t==="string"?[null,t]:typeof t==="object"&&!e?[t]:[t,e];return this.addCmd({c:u,a:s})};g2.prototype.txt=function g(t,e,s,i,r){return this.addCmd({c:g,a:[t,e||0,s||0,i||0,r]})};g2.prototype.img=function y(t,e,s,i,r,o,n,a,h){var c=new Image,f=this.state;f.loading++;c.onload=function p(){f.loaded()};c.onerror=function(){c.src=g2.prototype.img.broken};c.src=t;return this.addCmd({c:y,a:[c,e+.5||0,s+.5||0,i,r,o,n,a,h]})};g2.prototype.img.broken="data:image/gif;base64,R0lGODlhHgAeAKIAAAAAmWZmmZnM/////8zMzGZmZgAAAAAAACwAAAAAHgAeAEADimi63P5ryAmEqHfqPRWfRQF+nEeeqImum0oJQxUThGaQ7hSs95ezvB4Q+BvihBSAclk6fgKiAkE0kE6RNqwkUBtMa1OpVlI0lsbmFjrdWbMH5Tdcu6wbf7J8YM9H4y0YAE0+dHVKIV0Efm5VGiEpY1A0UVMSBYtPGl1eNZhnEBGEck6jZ6WfoKmgCQA7";g2.prototype.lin=function x(t,e,s,i,r){return this.addCmd({c:x,a:[t,e,s,i,r]})};g2.prototype.rec=function m(t,e,s,i,r){return this.addCmd({c:m,a:[t,e,s,i,r]})};g2.prototype.cir=function v(t,e,s,i){return this.addCmd({c:v,a:[t,e,s,i]})};g2.prototype.arc=function b(t,e,s,i,r,o){return this.addCmd({c:b,a:[t,e,s,i||0,r||2*Math.PI,o]})};g2.prototype.ply=function C(t,e,s){var i=C.itrOf(t,s);if(i)this.addCmd({c:C,a:[t,e,i,s]});return this};g2.prototype.ply.iterators={"x,y":function(t){function e(e){return{x:t[2*e],y:t[2*e+1]}}e.len=t.length/2;return e},"[x,y]":function(t){function e(e){return{x:t[e][0],y:t[e][1]}}e.len=t.length;return e},"{x,y}":function(t){function e(e){return t[e]}e.len=t.length;return e}};g2.prototype.ply.itrOf=function(t,e){return!(t&&t.length)?undefined:e&&typeof e.itr==="function"?e.itr(t):typeof t[0]==="number"?g2.prototype.ply.iterators["x,y"](t):Array.isArray(t[0])&&t[0].length>=2?g2.prototype.ply.iterators["[x,y]"](t):typeof t[0]==="object"&&"x"in t[0]&&"y"in t[0]?g2.prototype.ply.iterators["{x,y}"](t):undefined};g2.prototype.spline=function w(t,e,s){var i=g2.prototype.ply.itrOf(t,s);if(i){var r=[],o,n=i.len,a,h,c,f,p,d,l,u,g,y,x,m,v;for(var o=0;o<(e?n:n-1);o++){if(o===0){a=e?i(n-1):{x:2*i(0).x-i(1).x,y:2*i(0).y-i(1).y};h=i(0);c=i(1);f=n===2?e?i(0):{x:2*i(1).x-i(0).x,y:2*i(1).y-i(0).y}:i(2);p=Math.max(Math.hypot(h.x-a.x,h.y-a.y),Number.EPSILON);d=Math.max(Math.hypot(c.x-h.x,c.y-h.y),Number.EPSILON)}else{a=h;h=c;c=f;f=o===n-2?e?i(0):{x:2*i(n-1).x-i(n-2).x,y:2*i(n-1).y-i(n-2).y}:o===n-1?i(1):i(o+2);p=d;d=l}l=Math.max(Math.hypot(f.x-c.x,f.y-c.y),Number.EPSILON);u=Math.sqrt(p*d),g=Math.sqrt(d*l),y=2*p+3*u+d,x=2*l+3*g+d,m=3*(p+u),v=3*(l+g);r.push({x:h.x,y:h.y,x1:(-d*a.x+y*h.x+p*c.x)/m,y1:(-d*a.y+y*h.y+p*c.y)/m,x2:(-d*f.x+x*c.x+l*h.x)/v,y2:(-d*f.y+x*c.y+l*h.y)/v})}r.push(e?{x:i(0).x,y:i(0).y}:{x:i(n-1).x,y:i(n-1).y});this.addCmd({c:w,a:[r,e,s]})}return this};g2.prototype.beg=function j(t){return this.addCmd(t?{c:j,a:[t],open:true}:{c:j,open:true})};g2.prototype.end=function O(){return this.addCmd({c:O})};g2.prototype.end.myBeg=function(t){if(t.c===g2.prototype.beg.cmd&&t.open===true){delete t.open;return true}return false};g2.prototype.clr=function A(){return this.addCmd({c:A})};g2.prototype.grid=function P(t,e){this.state.gridBase=2;this.state.gridExp=1;return this.addCmd({c:P,a:[t,e]})};g2.prototype.grid.getSize=function(t,e){var s=t.gridBase||2,i=t.gridExp||1,r;while((r=e*s*Math.pow(10,i))<14||r>35){if(r<14){if(s==1)s=2;else if(s==2)s=5;else if(s==5){s=1;i++}}else{if(s==1){s=5;i--}else if(s==2)s=1;else if(s==5)s=2}}t.gridBase=s;t.gridExp=i;return r};g2.prototype.use=function k(t,e){if(typeof t==="string")t=g2.symbol[t];if(t&&t!==this){var s=this.state;if(t.state&&t.state.loading){s.loading++;t.state.onload(g2.State.prototype.loaded.bind(s))}this.addCmd({c:k,a:[t,e]})}return this};g2.prototype.style=function M(t){return this.addCmd({c:M,a:[t]})};g2.prototype.exe=function S(t){var e=this.state;if(e.loading)requestAnimationFrame(S.bind(this,t));else if(t){var s,i,r=this.cmds;e.pre(t);s=e.ctx;i=e.ifc;S.pre[i].call(s,this);for(var o=0,n=r.length,a;o<n;o++)(a=r[this.curIdx=o]).c[i].apply(s,a.a);S.post[i].call(s,this);e.post()}return this};g2.prototype.exe.pre={};g2.prototype.exe.post={};g2.prototype.cpy=function T(t){if(t&&t!==this)t.cmds.forEach(function(t){this.cmds.push(t)},this);return this};g2.prototype.proxy=function D(t,e){if(typeof t==="string")t=g2.prototype[t];if(t&&t.proto){var s=function(){};s.proto=t.proto;this.addCmd({a:e,c:s})}return this};g2.prototype.findCmdIdx=function(t){for(var e=this.cmds.length-1;e>=0;e--)if(t(this.cmds[e],e,this.cmds))return e;return false};g2.prototype.pntToUsr=function I(t,e,s){var i=this.state&&this.state.trf0||false;return!i?{x:t,y:e}:this.state.cartesian?{x:(t-i.x)/i.scl,y:-(e-(s-i.y))/i.scl}:{x:(t-i.x)/i.scl,y:(e-i.y)/i.scl}};g2.prototype.vecToUsr=function E(t,e){var s=this.state&&this.state.trf0||false;return!s?{x:t,y:e}:this.state.cartesian?{x:t/s.scl,y:-e/s.scl}:{x:t/s.scl,y:e/s.scl}};g2.transparent="rgba(0, 0, 0, 0)";g2.exeStack=0;g2.context=Object.create(null);g2.ifc=Object.create(null);g2.State={create:function(){var t=Object.create(this.prototype);t.constructor.apply(t,arguments);return t},prototype:{constructor:function(){this.stack=[{}];this._current={};this.trf0={x:0,y:0,w:0,scl:1};this.loading=0;this.loadHdl=[]},pre:function(t){for(var e in g2.ifc)if(g2.ifc[e](t))this.ctx=g2.context[this.ifc=e](t);this.stack=[{}];this._current={}},post:function(){delete this.ctx;delete this.ifc},get:function(t){return t in this?this[t]:this._current[t]||g2.State[t]},set:function(t,e){this._current[t]=e},add:function(t){var e=g2.State[this.ifc],s,i,r={};for(var o in t){i=t[o];if(typeof i==="string"&&i[0]==="@"&&!(i=this.get(i.substr(1))))break;if(o==="x"||o==="y"||o==="w"||o==="scl")r[o]=i;else if(!(o in this._current)||i!==this._current[o]){this._current[o]=i;if(e[o])e[o].call(this.ctx,i,this)}}if(Object.keys(r).length){this.trf=r;if(e["trf"])e["trf"].call(this.ctx,r,this)}return this},save:function(){this.stack.push(Object.assign({},this._current));return this},restore:function(){this._current=Object.assign({},this.stack.pop());return this},get current(){return this._current},set current(t){this._current=t},get trf(){return this._current.trf||this.trf0},set trf(t){var e=t.w||0,s=t.scl||1,i=s*(e?Math.sin(e):0),r=s*(e?Math.cos(e):1),o=this._current.trf||this.trf0;this._current.trf={x:r*o.x-i*o.y+(t.x||0),y:i*o.x+r*o.y+(t.y||0),w:o.w+e,scl:o.scl*s}},get lwOwner(){return this._current["lw"]},get cssFont(){var t=this.get("fos"),e=this.get("fow");return(t==="normal"?"":t+" ")+(e==="normal"?"":e+" ")+(this.get("foz")+"px "+this.get("fof"))},onload:function _(t){this.loadHdl.push(t)},loaded:function z(){if(--this.loading===0){while(this.loadHdl.length)this.loadHdl.pop()()}}},fs:g2.transparent,ls:"#000",lw:1,lc:"butt",lj:"miter",lwnosc:false,ml:10,sh:[0,0,0,g2.transparent],foc:"#000",fos:"normal",fow:"normal",foz:12,fof:"serif",foznosc:false,trf:{x:0,y:0,w:0,scl:1}};g2.symbol=Object.create(null);if(typeof CanvasRenderingContext2D!=="undefined"){g2.ifc.c2d=function(t){return t instanceof CanvasRenderingContext2D};g2.context.c2d=function(t){return t};g2.prototype.exe.pre.c2d=function(t){if(!this.g2ified){this.fillStyle=g2.transparent;this.font=t.state.cssFont;this.save();this.g2ified=true}if(g2.exeStack++===0){var e=this.g2state=t.state,s=e.trf;this.setTransform(s.scl,0,0,e.cartesian?-s.scl:s.scl,s.x+.5,(e.cartesian?this.canvas.height-s.y:s.y)+.5);this.save()}};g2.prototype.exe.post.c2d=function(){if(--g2.exeStack===0){delete this.g2state;this.restore()}};g2.prototype.p.c2d=CanvasRenderingContext2D.prototype.beginPath;g2.prototype.m.c2d=CanvasRenderingContext2D.prototype.moveTo;g2.prototype.l.c2d=CanvasRenderingContext2D.prototype.lineTo;g2.prototype.q.c2d=CanvasRenderingContext2D.prototype.quadraticCurveTo;g2.prototype.c.c2d=CanvasRenderingContext2D.prototype.bezierCurveTo;g2.prototype.a.c2d=CanvasRenderingContext2D.prototype.arc;g2.prototype.z.c2d=CanvasRenderingContext2D.prototype.closePath;g2.prototype.stroke.c2d=function R(t,e){if(t){this.save();this.g2state.save().add(t)}if(e&&typeof Path2D!=="undefined")this.stroke(new Path2D(e));else this.stroke();if(t){this.g2state.restore();this.restore()}};g2.prototype.fill.c2d=function B(t,e){if(t){this.save();this.g2state.save().add(t)}if(e&&typeof Path2D!=="undefined")this.fill(new Path2D(e));else this.fill();if(t){this.g2state.restore();this.restore()}};g2.prototype.drw.c2d=function N(t,e){var s=e&&typeof Path2D!=="undefined"?new Path2D(e):false;if(t){this.save();this.g2state.save().add(t)}s?this.fill(s):this.fill();if(this.fillStyle!==g2.transparent&&this.shadowColor!==g2.transparent){var i=this.shadowColor;this.shadowColor="transparent";s?this.stroke(s):this.stroke();this.shadowColor=i}else s?this.stroke(s):this.stroke();if(t){this.g2state.restore();this.restore()}};g2.prototype.txt.c2d=function q(t,e,s,i,r){var o=this.g2state;this.save();if(r)o.save().add(r);if(i){var n=Math.sin(i),a=Math.cos(i);this.transform(a,n,-n,a,(1-a)*e+n*s,-n*e+(1-a)*s)}if(o.cartesian){this.scale(1,-1);s=-s}if(o.get("foc")!==g2.transparent){this.fillStyle=o.get("foc");this.fillText(t,e,s)}else{this.fillText(t,e,s);this.strokeText(t,e,s)}if(r)o.restore();this.restore()};g2.prototype.img.c2d=function H(t,e,s,i,r,o,n,a,h){var c=this.g2state.cartesian;i=i||t&&t.width;r=r||t&&t.height;if(c){this.scale(1,-1);s=-s-r}if(o||n||a||h)this.drawImage(t,o,n,a,h,e,s,i,r);else this.drawImage(t,e,s,i,r);if(c){this.scale(1,-1)}};g2.prototype.lin.c2d=function L(t,e,s,i,r){if(r){this.save();this.g2state.save().add(r)}this.beginPath();this.moveTo(t,e);this.lineTo(s,i);this.stroke();if(r){this.g2state.restore();this.restore()}};g2.prototype.rec.c2d=function F(t,e,s,i,r){if(r){this.save();this.g2state.save().add(r)}this.beginPath();this.rect(t,e,s,i);g2.prototype.drw.c2d.call(this);if(r){this.g2state.restore();this.restore()}};g2.prototype.cir.c2d=function W(t,e,s,i){if(i){this.save();this.g2state.save().add(i)}this.beginPath();this.arc(t,e,s,0,Math.PI*2,true);g2.prototype.drw.c2d.call(this);if(i){this.g2state.restore();this.restore()}};g2.prototype.arc.c2d=function G(t,e,s,i,r,o){if(o){this.save();this.g2state.save().add(o)}this.beginPath();this.arc(t,e,s,i,i+r,r<0);g2.prototype.drw.c2d.call(this);if(o){this.g2state.restore();this.restore()}};g2.prototype.ply.c2d=function Z(t,e,s,i){var r,o=0,n=e==="split";this.beginPath();this.moveTo((r=s(0)).x,r.y);for(o=1;o<s.len;o++){r=s(o);if(n&&o%2)this.moveTo(r.x,r.y);else this.lineTo(r.x,r.y)}if(e&&!n)this.closePath();g2.prototype.drw.c2d.call(this,i);return o-1};g2.prototype.spline.c2d=function Q(t,e,s){this.beginPath();this.moveTo(t[0].x,t[0].y);for(var i=0,r=t.length;i<r-1;i++)this.bezierCurveTo(t[i].x1,t[i].y1,t[i].x2,t[i].y2,t[i+1].x,t[i+1].y);if(e)this.closePath();g2.prototype.drw.c2d.call(this,s)};g2.prototype.beg.c2d=function U(t){this.save();this.g2state.save().add(t)};g2.prototype.end.c2d=function V(){this.g2state.restore();this.restore()};g2.prototype.clr.c2d=function Y(){this.save();this.setTransform(1,0,0,1,0,0);this.clearRect(0,0,this.canvas.width,this.canvas.height);this.restore()};g2.prototype.grid.c2d=function K(t,e){var s=this.g2state,i=s.trf0,r=this.canvas.width,o=this.canvas.height,n=e||g2.prototype.grid.getSize(s,i.scl),a=i.x?i.x%n-n:0,h=i.y?i.y%n-n:0;this.save();if(s.cartesian)this.setTransform(1,0,0,-1,.5,o-.5);else this.setTransform(1,0,0,1,.5,.5);this.strokeStyle=t||"#ccc";this.lineWidth=1;this.beginPath();for(var c=a,f=r+1;c<f;c+=n){this.moveTo(c,0);this.lineTo(c,o)}for(var p=h,d=o+1;p<d;p+=n){this.moveTo(0,p);this.lineTo(r,p)}this.stroke();this.restore()};g2.prototype.use.c2d=function J(t,e){var s=this.g2state,i=t.state;this.save();s.save().add(e);t.state=s;t.exe(this);t.state=i;s.restore();this.restore()};g2.prototype.style.c2d=function X(t){this.g2state.add(t)};g2.State.c2d={fs:function(t){this.fillStyle=t==="transparent"?g2.transparent:t},ls:function(t){this.strokeStyle=t==="transparent"?g2.transparent:t},lw:function(t,e){this.lineWidth=t/(e.get("lwnosc")?e.trf.scl:1)},lc:function(t){this.lineCap=t},lj:function(t){this.lineJoin=t},lo:function(t){this.lineDashOffset=t},ld:function(t,e){var s=e.get("lwnosc")?e.trf.scl:1;if(s!==1){var i=[];for(var r=0,o=t.length;r<o;r++)i.push(t[r]/s);this.setLineDash(i)}else this.setLineDash(t)},ml:function(t){this.miterLimit=t},sh:function(t){if(t&&t.length>1){this.shadowOffsetX=t[0];this.shadowOffsetY=t[1];this.shadowBlur=t[2]||0;this.shadowColor=t[3]||"rgba(0,0,0,0.5)"}},thal:function(t){this.textAlign=t},tval:function(t){this.textBaseline=t},fos:function(t,e){this.font=e.cssFont},fow:function(t,e){this.font=e.cssFont},foz:function(t,e){this.font=e.cssFont},fof:function(t,e){this.font=e.cssFont},trf:function(t,e){var s=t.scl||1,i=s*(t.w?Math.sin(t.w):0),r=s*(t.w?Math.cos(t.w):1);this.transform(r,i,-i,r,t.x||0,t.y||0);if(e.get("lwnosc")&&s!==1)g2.State.c2d.lwscale.call(this,1/s)},matrix:function(t){this.transform.apply(this,t)},lwnosc:function(t,e){var s=e.trf.scl;if(s!==1)g2.State.c2d.lwscale.call(this,t?1/s:s)},lwscale:function(t){var e=this.getLineDash();this.lineWidth*=t;if(e.length){for(var s=0,i=e.length;s<i;s++)e[s]*=t;this.lineDashOffset*=t;this.setLineDash(e)}}}}if(typeof module==="object"&&module.exports)module.exports=g2;